<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="This mapping project explores the relationship between locations of grocery stores, and factors such as demographics and transportation.">
  <meta name="author" content="Emily Siangkam">
  <title>Grocery Store Access in King County</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/ardhi/Leaflet.MousePosition/master/src/L.Control.MousePosition.css">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&amp;display=swap" rel="stylesheet">
  <style>
         html,
         body, #map {
         width: 100%;
         height: 100%;
         margin: 0;
         background: #fff;
         }
         .legend {
         line-height: 16px;
         width: 180px;
         color: #333333;
         font-family: 'Open Sans', cursive;
         padding: 6px 8px;
         background: white;
         background: rgba(255,255,255,0.5);
         box-shadow: 0 0 15px rgba(0,0,0,0.2);
         border-radius: 5px;
         }
         .legend i {
         width: 16px;
         height: 16px;
         float: left;
         margin-right: 8px;
         opacity: 0.9;
         }
         .legend img {
         width: 16px;
         height: 16px;
         margin-right: 3px;
         float: left;
         }
         .legend p {
         font-size: 12px;
         line-height: 16px;
         margin: 0;
         }
  </style>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/ardhi/Leaflet.MousePosition/master/src/L.Control.MousePosition.js"></script>
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Grocery Store Access in King County</a>
    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="about.html">About</a>
        </li>
      </ul>
    </div>
  </nav><!-- <main role="main"> -->
  <div id="map"></div><!-- </main> -->
  <script>
     // Create a map object.
     var mymap = L.map('map', {
       center: [47.55799042752343, -122.30375024543308],
       zoom: 10,
       maxZoom: 14,
       minZoom: 1,
       detectRetina: true
     });

     var grayscale = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}@2x.png').addTo(mymap);
     var streets = L.tileLayer('http://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}@2x.png');
     var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}@2x');

     // Add grocery stores GeoJSON Data
     // Null variable that will hold stores data
     var stores = null;
     var shopIcon = L.icon({
         iconUrl: 'img/grocery.svg',
         iconSize: [20, 20], // size of the icon
     });
     // Get GeoJSON and put on it on the map when it loads
     stores = L.geoJson.ajax("assets/grocerystores.geojson", {
         // assign a function to the onEachFeature parameter of the stores object.
         // Then each (point) feature will bind a popup window.
         // The content of the popup window is the values of the store's name, address, and city`
         onEachFeature: function (feature, layer) {
             layer.bindPopup('<center>' + feature.properties.NAME + "<br> Location: " + feature.properties.ADDRESS + ', <\/br>' + feature.properties.CITY);
         },
         pointToLayer: function (feature, latlng) {
             return L.marker(latlng, {icon: shopIcon});
             },
         attribution: 'Grocery Stores in King County | Data: King County GIS Open Data | Generated by Emily Siangkam'
     }).addTo(mymap);

     // Get Median Household Income GeoJSON and put on it on the map
    var mhi = L.geoJson.ajax("assets/mhi.geojson", {
        style: mhi_style,
        onEachFeature: function(feature, layer) {
          layer.bindPopup('<center>' + 'Median Household Income: $' + feature.properties.MHHI1);
        },
        attribution: 'Median Household Income | Data: King County GIS Open Data | Generated by Emily Siangkam',
    });

    // Set function for MHI color ramp
     var mhi_colors = chroma.scale('YlGn').colors(5);

     function mhiColor(income) {
       var id = 0;
       if (income > 130000) {
         id = 4;
       } else if (income > 96838 && income <= 130000) {
         id = 3;
       } else if (income > 77637 && income <= 96837) {
         id = 2;
       } else if (income > 55171 && income <= 77636) {
         id = 1;
       } else {
         id = 0;
       }
       return mhi_colors[id];
     }

     // Set style function that sets fill color.md property equal to census tract's MHI
     function mhi_style(feature) {
       return {
         fillColor: mhiColor(feature.properties.MHHI1),
         fillOpacity: 0.8,
         weight: 2,
         opacity: 1,
         color: '#b4b4b4',
         dashArray: '1'
       };
     }

     // Get People of Color GeoJSON and put on it on the map
    var poc = L.geoJson.ajax("assets/poc.geojson", {
        style: poc_style,
        onEachFeature: function(feature, layer) {
          layer.bindPopup('<center>' + 'Percent People of Color: ' + feature.properties.Percentage + "%");
        },
        attribution: 'Percent People of Color | Data: King County GIS Open Data | Generated by Emily Siangkam',
    });

    // Set function for POC color ramp
     var poc_colors = chroma.scale('YlGnBu').colors(5);

     function pocColor(percent) {
       var id = 0;
       if (percent > 68) {
         id = 4;
       } else if (percent > 52 && percent <= 68) {
         id = 3;
       } else if (percent > 37 && percent <= 52) {
         id = 2;
       } else if (percent > 23 && percent <= 37) {
         id = 1;
       } else {
         id = 0;
       }
       return poc_colors[id];
     }

     // Set style function that sets fill color.md property equal to census tract's POC percentage
     function poc_style(feature) {
       return {
         fillColor: pocColor(feature.properties.Percentage),
         fillOpacity: 0.8,
         weight: 2,
         opacity: 1,
         color: '#b4b4b4',
         dashArray: '1'
       };
     }

     // Get transit GeoJSON and put on it on the map
     var transit = L.geoJson.ajax("assets/transit.geojson", {
         onEachFeature: function(feature, layer) {
           layer.bindPopup('<center>' + 'Route Number: ' + feature.properties.ROUTE_NUM);
         },
         attribution: 'Transit Routes | Data: King County GIS Open Data | Generated by Emily Siangkam',
     });

     // Create base layers variable for basemap control
     var baseLayers = {
       'Grayscale': grayscale,
       'Streets': streets,
       'Satellite': satellite
     };

     // Create overlay variable for thematic layer control
     var overlays = {
       "Grocery Stores": stores,
       "Median Household Income": mhi,
       "Percent People of Color": poc,
       "Transit Routes": transit
     }

    // Create Leaflet Control Object for layers
     L.control.layers(baseLayers, overlays, {
        collapsed: false,
        position: 'topright'
      }).addTo(mymap);

      // Create Leaflet Control Object for Legend
      var legend = L.control({position: 'topright'});

      // Function that runs when legend is added to map
      legend.onAdd = function () {

          // Create Div Element and Populate it with HTML
          var div = L.DomUtil.create('div', 'legend');
          div.innerHTML += '<b>Food Locations<b><br />';
          div.innerHTML += '<img src="img/grocery.svg" alt="Grocery bag"><\/i><p> Grocery Store <\/p>';
          div.innerHTML += '<hr><b>Median Household Income<\/b><br/>';
          div.innerHTML += '<i style="background: ' + mhi_colors[4] + '; opacity: 0.5"><\/i><p> $130,000+ <\/p>';
          div.innerHTML += '<i style="background: ' + mhi_colors[3] + '; opacity: 0.5"><\/i><p> $96,838 - $130,000 <\/p>';
          div.innerHTML += '<i style="background: ' + mhi_colors[2] + '; opacity: 0.5"><\/i><p> $77,636 - $96,838 <\/p>';
          div.innerHTML += '<i style="background: ' + mhi_colors[1] + '; opacity: 0.5"><\/i><p> $55,171 - $77,636 <\/p>';
          div.innerHTML += '<i style="background: ' + mhi_colors[0] + '; opacity: 0.5"><\/i><p> $10,865 - $55,171 <\/p>';
          div.innerHTML += '<hr><b>Percent People of Color<\/b><br/>';
          div.innerHTML += '<i style="background: ' + poc_colors[4] + '; opacity: 0.5"><\/i><p> 68+ <\/p>';
          div.innerHTML += '<i style="background: ' + poc_colors[3] + '; opacity: 0.5"><\/i><p> 52-68 <\/p>';
          div.innerHTML += '<i style="background: ' + poc_colors[2] + '; opacity: 0.5"><\/i><p> 37-52 <\/p>';
          div.innerHTML += '<i style="background: ' + poc_colors[1] + '; opacity: 0.5"><\/i><p> 23-37 <\/p>';
          div.innerHTML += '<i style="background: ' + poc_colors[0] + '; opacity: 0.5"><\/i><p> 4-23 <\/p>';
          // Return the Legend div containing the HTML content
          return div;
      };

      // Add legend to the map
      legend.addTo(mymap);

      // Add a scale bar to map
      L.control.scale({position: 'bottomleft'}).addTo(mymap);

      // Add coordinates on map for mouse position
      L.control.mousePosition().addTo(mymap);

  </script>
</body>
</html>
